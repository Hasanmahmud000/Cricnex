<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Admin â€“ BDStreamHub</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #1f1f1f;
      color: #eee;
    }
    header {
      background: #111;
      padding: 15px 20px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      color: #08f;
    }
    #login-section, #admin-section {
      max-width: 500px;
      margin: 40px auto;
      background: #222;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 15px #000a;
    }
    #login-section input {
      width: 100%;
      padding: 12px;
      margin-bottom: 12px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
    }
    #login-section button {
      width: 100%;
      padding: 12px;
      background: #08f;
      border: none;
      border-radius: 6px;
      color: #111;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
    }
    #login-msg { color: #f55; text-align: center; margin-top: 10px; }

    form input, form textarea {
      width: 100%;
      margin: 8px 0;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #1a1a1a;
      color: #eee;
      font-size: 14px;
    }
    form label {
      font-size: 14px;
      margin-top: 8px;
      display: block;
    }
    form button {
      width: 100%;
      padding: 12px;
      background: #08f;
      border: none;
      border-radius: 6px;
      color: #111;
      font-size: 16px;
      font-weight: bold;
      margin-top: 12px;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
      background: #222;
      border-radius: 8px;
      overflow: hidden;
    }
    table th, table td {
      padding: 10px;
      border-bottom: 1px solid #444;
      text-align: left;
      font-size: 14px;
    }
    table th {
      background: #111;
      color: #08f;
    }
    .action-btn {
      background: #08f;
      color: #111;
      border: none;
      padding: 6px 12px;
      margin-right: 6px;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
    }
    .action-btn.delete {
      background: #f33;
      color: #fff;
    }
    .action-btn:hover { opacity: 0.8; }

    @media (max-width: 600px) {
      table, thead, tbody, th, td, tr { display: block; }
      table thead { display: none; }
      tr { margin-bottom: 15px; }
      td { padding-left: 50%; position: relative; }
      td::before {
        position: absolute; left: 10px; top: 10px;
        color: #08f; font-weight: bold;
      }
      td:nth-of-type(1)::before { content: "Match"; }
      td:nth-of-type(2)::before { content: "Time"; }
      td:nth-of-type(3)::before { content: "Server 1"; }
      td:nth-of-type(4)::before { content: "Server 2"; }
      td:nth-of-type(5)::before { content: "Server 3"; }
      td:nth-of-type(6)::before { content: "Actions"; padding-left: 0; }
    }
  </style>
</head>
<body>

  <header>BDStreamHub Admin</header>

  <!-- Login Section -->
  <div id="login-section">
    <input type="password" id="admin-password" placeholder="Enter Admin Password"/>
    <button onclick="doLogin()">Login</button>
    <div id="login-msg"></div>
  </div>

  <!-- Admin Panel -->
  <div id="admin-section" style="display:none;">
    <form id="match-form" onsubmit="saveMatch(event)">
      <label>Match Title</label>
      <input name="matchTitle" required/>

      <label>Team 1 Name</label>
      <input name="team1" required/>

      <label>Team 2 Name</label>
      <input name="team2" required/>

      <label>Team 1 Logo URL</label>
      <input name="team1Logo" required/>

      <label>Team 2 Logo URL</label>
      <input name="team2Logo" required/>

      <label>Match Date &amp; Time (BD Time, ISO w/ +06:00)</label>
      <input name="matchTime" type="datetime-local" step="1" required/>

      <label>Server 1 URL</label>
      <input name="server1" required/>

      <label>Server 2 URL (optional)</label>
      <input name="server2"/>

      <label>Server 3 URL (optional)</label>
      <input name="server3"/>

      <label>Notice (optional)</label>
      <textarea name="notice" rows="2"></textarea>

      <button type="submit">Save Match</button>
    </form>

    <table id="history-table">
      <thead>
        <tr>
          <th>Match</th>
          <th>Time (BD)</th>
          <th>Srv1</th>
          <th>Srv2</th>
          <th>Srv3</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const API_URL = "YOUR_WEB_APP_URL?action=";
    const ADMIN_PASSWORD = "admin123"; // change this!

    function doLogin() {
      const pwd = document.getElementById('admin-password').value;
      if (pwd === ADMIN_PASSWORD) {
        document.getElementById('login-section').style.display = 'none';
        document.getElementById('admin-section').style.display = 'block';
        loadMatches();
      } else {
        document.getElementById('login-msg').innerText = 'Wrong password!';
      }
    }

    // Fetch and display existing matches
    async function loadMatches() {
      const res = await fetch(API_URL + 'get');
      const data = await res.json();
      const tbody = document.querySelector('#history-table tbody');
      tbody.innerHTML = '';
      data.matches.forEach(m => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${m.matchTitle}</td>
          <td>${new Date(m.matchTime).toLocaleString('en-GB', { timeZone: 'Asia/Dhaka', hour12: true })}</td>
          <td><a href="${m.server1}" target="_blank">Link</a></td>
          <td>${m.server2? `<a href="${m.server2}" target="_blank">Link</a>` : ''}</td>
          <td>${m.server3? `<a href="${m.server3}" target="_blank">Link</a>` : ''}</td>
          <td class="actions">
            <button class="action-btn" onclick="editMatch('${m.matchTitle}')">Edit</button>
            <button class="action-btn delete" onclick="deleteMatch('${m.matchTitle}')">Delete</button>
          </td>`;
        tbody.appendChild(row);
      });
    }

    // Save new or edited match
    async function saveMatch(e) {
      e.preventDefault();
      const form = e.target;
      const data = {};
      new FormData(form).forEach((v,k) => data[k] = v);

      // Convert datetime-local (browser) to ISO+06:00
      const dt = new Date(data.matchTime);
      const offset = dt.getTimezoneOffset(); // in mins
      const bdOffset = -360; // +6h => -360min
      const bdTime = new Date(dt.getTime() + (offset - bdOffset) * 60000);
      data.matchTime = bdTime.toISOString().replace('Z','+06:00');

      // Determine action
      const action = form.dataset.editing ? 'edit' : 'add';
      data.password = ADMIN_PASSWORD;

      const res = await fetch(API_URL + action + '&password=' + ADMIN_PASSWORD + '&matchTitle=' + encodeURIComponent(data.matchTitle), {
        method:'POST',
        body: JSON.stringify(data)
      });
      const txt = await res.text(); alert(txt);
      form.reset(); delete form.dataset.editing;
      loadMatches();
    }

    // Populate form for editing
    function editMatch(title) {
      const row = [...document.querySelectorAll('#history-table tbody tr')]
        .find(r => r.children[0].innerText === title);
      if (!row) return;
      const cols = row.children;
      const form = document.getElementById('match-form');
      form.matchTitle.value = cols[0].innerText;
      // parse BD time back to local datetime-local
      const iso = new Date(cols[1].innerText).toISOString().slice(0,16);
      form.matchTime.value = iso;
      // fetch servers from links
      form.server1.value = cols[2].querySelector('a').href;
      form.server2.value = cols[3].querySelector('a')?.href || '';
      form.server3.value = cols[4].querySelector('a')?.href || '';
      form.notice.value = ''; // personal notice row
      form.dataset.editing = 'true';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Delete match
    async function deleteMatch(title) {
      if (!confirm('Delete '+title+'?')) return;
      const res = await fetch(API_URL + 'delete&password=' + ADMIN_PASSWORD + '&matchTitle=' + encodeURIComponent(title));
      alert(await res.text());
      loadMatches();
    }
  </script>
</body>
</html>
