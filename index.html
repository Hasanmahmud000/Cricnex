<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Live Stream Player</title>
  <script src="https://cdn.jsdelivr.net/npm/shaka-player@latest/dist/shaka-player.compiled.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body { background:#000; color:#fff; font-family:sans-serif; margin:0; text-align:center; }
    img { max-height:80px; margin:10px auto; display:block; }
    #countdown, #notice { margin:10px 0; font-size:18px;}
    video { width:100%; max-width:800px; }
    .overlay { background:rgba(0,0,0,0.7); padding:5px; position:absolute; top:5px; left:5px; color:#fff;}
  </style>
</head>
<body>

  <img id="logo">
  <div id="team-logos">
    <img id="team1"><img id="team2">
  </div>
  <h2 id="match-title">Live Match</h2>
  <div id="countdown">Loading...</div>
  <marquee id="notice">Loading notice...</marquee>

  <video id="video" controls autoplay muted playsinline></video>
  <div class="overlay" id="status">Initializing...</div>

  <img id="sponsor" style="width:100%;">

  <script>
  const c = JSON.parse(localStorage.getItem('liveConfig')||'{}');
  const now = Date.now();
  const start = c.startTime ? new Date(c.startTime).getTime() : now;
  document.getElementById('logo').src = c.logo;
  document.getElementById('team1').src = c.team1;
  document.getElementById('team2').src = c.team2;
  document.getElementById('sponsor').src = c.sponsor;
  document.getElementById('notice').innerText = c.notice;

  function tick() {
    const diff = start - Date.now();
    if(diff>0) {
      const m=Math.floor(diff/60000), s=Math.floor((diff%60000)/1000);
      document.getElementById('countdown').innerText=`‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶¨‡ßá ${m}‡¶Æ‡¶ø ${s}‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá`;
    } else {
      document.getElementById('countdown').innerText='üî¥ LIVE ‡¶ö‡¶≤‡¶õ‡ßá';
    }
  }
  setInterval(tick,1000); tick();

  const vid = document.getElementById('video'), st = document.getElementById('status');
  (async ()=>{
    try {
      const ext = c.stream.split('.').pop().split('?')[0];
      if(ext==='m3u8') {
        if(Hls.isSupported()){
          const h=new Hls(); h.loadSource(c.stream); h.attachMedia(vid); h.on(Hls.Events.MANIFEST_PARSED,()=>st.innerText='‚ñ∂Ô∏è LIVE');
        } else vid.src=c.stream;
      } else if(ext==='mpd') {
        shaka.polyfill.installAll(); const p=new shaka.Player(vid);
        if(c.license) p.configure({drm:{servers:{'com.widevine.alpha':c.license}}});
        p.getNetworkingEngine().registerRequestFilter((type,req)=> {
          if(type===shaka.net.NetworkingEngine.RequestType.LICENSE){
            req.headers['Referer']=location.origin;
          }
        });
        await p.load(c.stream); st.innerText='‚ñ∂Ô∏è LIVE';
      } else {
        vid.src=c.stream; st.innerText='‚ñ∂Ô∏è Playing MP4';
      }
    } catch(err) {
      console.error(err); st.innerText='‚ùå Load Error';
    }
  })();
  </script>
</body>
</html>
