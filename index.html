<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BDStreamHub</title>
  <style>
    /* ================ RESET + GLOBALS ================ */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
    body { background: #111; color: #fff; }
    a { color: #08f; text-decoration: none; }
    button { cursor: pointer; }

    /* ================ HEADER ================ */
    header {
      background: #222;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 50px 30px;
      position: relative;
    }
    .logo { font-size: 1.2rem; font-weight: bold; }
    .search-circle {
      width: 40px; height: 40px;
      border: 2px solid #08f;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .search-circle input {
      width: 30px; height: 30px;
      background: transparent;
      border: none;
      color: #fff;
      text-align: center;
    }
    .menu-dot {
      font-size: 1.5rem;
      position: relative;
    }
    .menu-content {
      display: none;
      position: absolute;
      right: 15px;
      top: 45px;
      background: #333;
      padding: 10px;
      border-radius: 5px;
    }
    .menu-content a { display: block; }

    /* ================ NOTICE BAR ================ */
    .notice-bar {
      background: #ff0;
      color: #000;
      padding: 20px;
      white-space: nowrap;
      overflow: hidden;
    }
    .notice-text {
      display: inline-block;
      padding-left: 100%;
      animation: scroll-left 15s linear infinite;
    }
    @keyframes scroll-left {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    /* ================ TABS ================ */
    .tabs {
      display: flex;
      justify-content: center;
      margin: 15px 0;
    }
    .tabs button {
      background: #333;
      color: #fff;
      border: none;
      padding: 8px 12px;
      margin: 0 5px;
      border-radius: 5px;
    }
    .tabs button.active { background: #08f; }

    /* ================ MATCH CARDS ================ */
    #match-list {
  display: grid;
  grid-template-columns: 1fr; /* ‡¶∏‡¶¨‡¶∏‡¶Æ‡ßü ‡¶è‡¶ï ‡¶ï‡¶≤‡¶æ‡¶Æ */
  gap: 30px;
}

/* ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶Æ‡¶ø‡¶°‡¶ø‡ßü‡¶æ ‡¶ï‡ßã‡ßü‡ßá‡¶∞‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßã ‡¶¨‡¶æ ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶¶‡¶æ‡¶ì */
// @media(min-width: 800px) {
//   #match-list {
//     grid-template-columns: 1fr 1fr; /* ‡¶¶‡ßÅ‡¶á ‡¶ï‡¶≤‡¶æ‡¶Æ - ‡¶è‡¶ü‡¶æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶¨‡¶æ ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü */
//   }
// }
    .match-card {
      background: #222;
      padding: 55px;
      border-radius: 45px;
      position: relative;
    }
    .teams {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      font-weight: bold;
    }
    .teams img {
      width: 90px; height: 90px;
      border-radius: 50%;
      margin: 0 25px;
    }
    .live-badge, .coming-badge {
      position: absolute;
      top: 40px; left: 40px;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.9rem;
      animation: blink 1s infinite alternate;
    }
    .live-badge { background: red; color: #fff; }
    .coming-badge { background: orange; color: #000; }
    @keyframes blink {
      from { opacity: 1; } to { opacity: 0.3; }
    }
    .time-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px 0;
      font-size: 0.9rem;
      color: #ccc;
    }
    .timer {
      font-size: 0.95rem;
      text-align: center;
      padding: 6px 0;
      color: #0f8;
    }
    .btns {
      text-align: center;
      margin-top: 10px;
    }
    .btns a {
      margin: 0 5px;
      padding: 6px 10px;
      background: #08f;
      border-radius: 5px;
      color: #fff;
      font-size: 0.9rem;
    }

    /* ================ POPUP ================ */
    .overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .popup {
      background: #222;
      padding: 20px;
      border-radius: 8px;
      max-width: 90%;
      text-align: center;
    }
    .popup button {
      background: #08f;
      color: #fff;
      border: none;
      padding: 8px 14px;
      margin-top: 15px;
      border-radius: 5px;
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header>
    <div class="logo">BDStreamHub</div>
    <div class="search-circle">
      <input type="text" id="search" placeholder="üîç">
    </div>
    <div class="menu-dot" id="menuDot">‚ãÆ
      <div class="menu-content" id="menuContent">
        <a href="https://t.me/BDStreamHub_Discussion0" target="_blank">üîó Join our Telegram</a>
      </div>
    </div>
  </header>

  <!-- NOTICE BAR -->
  <div class="notice-bar">
    <div class="notice-text" id="noticeText"></div>
  </div>

  <!-- TABS -->
  <div class="tabs">
    <button id="liveTab" class="active">Live</button>
    <button id="upcomingTab">Upcoming</button>
  </div>

  <!-- MATCH LIST -->
  <div id="match-list"></div>

  <!-- TELEGRAM POPUP -->
  <div class="overlay" id="telegramOverlay">
    <div class="popup">
      <p>üëâ Join our Telegram group for updates!</p>
      <button id="joinBtn">Join Now</button>
    </div>
  </div>

  <script>
    // ====== Data fetch & state ======
    const apiUrl = "https://script.google.com/macros/s/AKfycbys6AFNs2s1MKZ1zyJxaeUW-_Vmq5BuIEC8Qjyr-zXkx_x28F7rWTi2D0EmQlnsPvTnCQ/exec";
    let matches = [];
    let noticeMessage = "";

    // ====== Utility ======
    function isMobile() {
      return /Mobi|Android/i.test(navigator.userAgent);
    }
    function msToDhms(ms) {
      let s = Math.floor(ms/1000), m = Math.floor(s/60), h = Math.floor(m/60), d = Math.floor(h/24);
      h%=24; m%=60; s%=60;
      return { d, h, m, s };
    }
    function formatDhms({d,h,m,s}) {
      return `${d}d ${h}h ${m}m ${s}s`;
    }

    // ====== Render Notice ======
    function updateNotice() {
      const userMessage = isMobile() ? "Download BDStreamHub_Tv App" : "Use VLC Media Player to stream";
      document.getElementById('noticeText').innerText = `${noticeMessage} ‚Äî ${userMessage}`;
    }

    // ====== Fetch Data ======
    async function fetchData() {
      try {
        const resp = await fetch(apiUrl);
        const data = await resp.json();
        matches = data.matches;
        noticeMessage = data.Notice || "";
        updateNotice();
        renderMatches();
      } catch (e) {
        console.error(e);
      }
    }

    // ====== Render Menu ======
    document.getElementById('menuDot').addEventListener('click', () => {
      const mc = document.getElementById('menuContent');
      mc.style.display = mc.style.display === 'block' ? 'none' : 'block';
    });
    window.addEventListener('click', e => {
      if (!document.getElementById('menuDot').contains(e.target)) {
        document.getElementById('menuContent').style.display = 'none';
      }
    });

    // ====== Render Matches ======
    function renderMatches() {
      const listEl = document.getElementById('match-list');
      listEl.innerHTML = "";
      const now = new Date();
      const filter = document.getElementById('search').value.toLowerCase();
      const liveTab = document.getElementById('liveTab').classList.contains('active');

      matches.forEach((m, i) => {
        const start = new Date(m.MatchTime);
        const diff = now - start;
        const isLive = diff >= 0 && diff < 2 * 3600000;
        const isUpcoming = diff < 0;
        if (liveTab && !isLive) return;
        if (!liveTab && !isUpcoming) return;
        const textMatch = `${m.Team1} ${m.Team2} ${m.Match}`.toLowerCase();
        if (filter && !textMatch.includes(filter)) return;

        const card = document.createElement('div');
        card.className = "match-card";

        // Badge
        const badge = document.createElement('div');
        if (isLive) {
          badge.className = "live-badge";
          badge.innerText = "LIVE";
        } else if (start - now <= 15 * 60000) {
          badge.className = "coming-badge";
          badge.innerText = "COMING";
        }
        if (badge.innerText) card.appendChild(badge);

        // Teams
        const teams = document.createElement('div');
        teams.className = "teams";
        teams.innerHTML = `<img src="${m.Team1Logo}"> ${m.Team1} vs ${m.Team2} <img src="${m.Team2Logo}">`;
        card.appendChild(teams);

        // Time info
        const ti = document.createElement('div');
        ti.className = "time-info";
        ti.innerText = `${start.toLocaleDateString()} ${start.toLocaleTimeString()}`;
        card.appendChild(ti);

        // Timer/countdown
        const timer = document.createElement('div');
        timer.className = "timer";
        card.appendChild(timer);

        // Buttons
        const btns = document.createElement('div');
        btns.className = "btns";
        ['Intent1','Intent2','Intent3'].forEach(key => {
          if (m[key]) {
            const a = document.createElement('a');
            a.href = m[key];
            a.target = "_blank";
            a.innerText = `Server ${key.slice(-1)}`;
            btns.appendChild(a);
          }
        });
        card.appendChild(btns);

        listEl.appendChild(card);

        // Timer update
        setInterval(() => {
          const now2 = new Date();
          const diff2 = now2 - start;
          if (isLive) {
            const since = msToDhms(diff2);
            timer.innerText = `Started ${since.m}m ${since.s}s ago`;
          } else {
            const left = msToDhms(start - now2);
            timer.innerText = `Starts in ${left.d}d ${left.h}h ${left.m}m ${left.s}s`;
          }
        }, 1000);
      });
    }

    // Tab handlers
    document.getElementById('liveTab').onclick = () => {
      document.getElementById('liveTab').classList.add('active');
      document.getElementById('upcomingTab').classList.remove('active');
      renderMatches();
    };
    document.getElementById('upcomingTab').onclick = () => {
      document.getElementById('upcomingTab').classList.add('active');
      document.getElementById('liveTab').classList.remove('active');
      renderMatches();
    };
    document.getElementById('search').addEventListener('input', renderMatches);

    // ====== Telegram Popup ======
    const overlay = document.getElementById('telegramOverlay');
    const joined = localStorage.getItem('tel_joined');
    if (!joined) overlay.style.display = 'flex';

    document.getElementById('joinBtn').onclick = () => {
      window.open("https://t.me/BDStreamHub_Discussion0", "_blank");
      localStorage.setItem('tel_joined', 'yes');
      overlay.style.display = 'none';
    };

    // ====== Init ======
    fetchData();
    setInterval(fetchData, 60 * 1000); // refresh every minute
  </script>
</body>
</html>
