<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>BDStreamHub - User Panel</title>
  <style>
    /* Reset */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Verdana, sans-serif;
      background: #111; color: #fff;
      min-height: 100vh; display: flex; flex-direction: column;
    }
    /* Header */
    nav {
      background: #222; display: flex;
      justify-content: space-between; align-items: center;
      padding: 10px 15px; position: sticky; top: 0; z-index: 100;
    }
    nav .left, nav .center, nav .right {
      display: flex; align-items: center;
    }
    nav .left a, nav .right a {
      color: #08f; text-decoration: none;
      font-weight: 600; margin-right: 15px; font-size: 18px;
    }
    nav .center {
      flex-grow: 1; justify-content: center;
      font-weight: 700; font-size: 20px; color: #08f;
    }
    /* Search */
    #search-wrapper { position: relative; }
    #search {
      width: 35px; height: 35px; border-radius: 50%;
      border: 2px solid #08f; background: transparent;
      color: #08f; text-align: center; font-size: 16px;
      outline: none; transition: width 0.3s, padding 0.3s;
    }
    #search:focus {
      width: 200px; border-radius: 4px; padding-left: 10px;
      cursor: text; text-align: left;
    }
    #search::placeholder { color: #08f; font-weight: 500; }
    /* Notice */
    #notice-bar {
      background: #ff0; color: #000; font-weight: 700;
      padding: 10px 15px; overflow: hidden; white-space: nowrap;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3); user-select: none;
    }
    #notice-text {
      display: inline-block; padding-left: 100%;
      animation: scrollNotice 15s linear infinite;
    }
    @keyframes scrollNotice {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
    /* Tabs */
    .tab-buttons {
      display: flex; justify-content: center;
      margin: 15px 0; user-select: none;
    }
    .tab-buttons button {
      background: #222; color: #08f; border: none;
      padding: 10px 25px; margin: 0 10px; border-radius: 30px;
      cursor: pointer; font-weight: 700; font-size: 16px;
      transition: background 0.3s, color 0.3s;
    }
    .tab-buttons button.active {
      background: #08f; color: #111;
    }
    /* Match List */
    #match-list {
      max-width: 900px; margin: 0 auto 50px; padding: 0 15px;
    }
    .match {
      background: #222; border-radius: 12px;
      margin-bottom: 18px; padding: 15px 20px;
      display: flex; flex-wrap: wrap;
      align-items: center; justify-content: space-around;
      box-shadow: 0 2px 8px rgba(0, 136, 255, 0.3);
    }
    .teams {
      display: flex; align-items: center;
      justify-content: center; flex: 1 1 250px; user-select: none;
    }
    .teams img {
      width: 48px; height: 48px; border-radius: 50%;
      margin: 0 12px; object-fit: contain;
      background: #000; border: 2px solid #08f;
    }
    .team-name {
      font-weight: 900; font-size: 18px;
      color: #08f; min-width: 90px; text-align: center;
    }
    .status {
      flex: 1 1 200px; text-align: center;
      font-size: 14px; user-select: none;
    }
    .live-badge {
      display: inline-block; background: red;
      padding: 4px 10px; border-radius: 20px;
      color: #fff; font-weight: 700;
      animation: liveBlink 1s infinite;
    }
    @keyframes liveBlink {
      0%,100% { opacity: 1; } 50% { opacity: 0.4; }
    }
    .countdown {
      font-weight: 600; margin-top: 6px;
    }
    .datetime {
      flex: 1 1 200px; text-align: center;
      font-size: 14px; color: #aaa; user-select: none;
    }
    .servers {
      flex: 1 1 180px; text-align: center;
    }
    .servers a {
      display: inline-block; margin: 5px 8px;
      padding: 8px 14px; background: #08f;
      color: #111; border-radius: 30px; font-weight: 700;
      text-decoration: none; transition: background 0.3s;
    }
    .servers a:hover { background: #05c; color: #fff; }
    /* Responsive */
    @media (max-width: 700px) {
      .match { flex-direction: column; text-align: center; }
      .teams, .status, .datetime, .servers {
        flex: none; margin: 8px 0;
      }
      nav .center { font-size: 18px; }
      nav .left a, nav .right a { font-size: 16px; }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <nav>
    <div class="left">
      <a href="index.html" title="Home">üè† Home</a>
      <a href="https://t.me/BDStreamHub_Discussion0" target="_blank">Join Telegram</a>
    </div>
    <div class="center">BDStreamHub</div>
    <div class="right">
      <div id="search-wrapper">
        <input id="search" type="search" placeholder="Search matches or teams" />
      </div>
    </div>
  </nav>

  <!-- Notice Bar -->
  <div id="notice-bar">
    <span id="notice-text">Loading notice‚Ä¶</span>
  </div>

  <!-- Tabs -->
  <div class="tab-buttons">
    <button id="liveTab" class="active">Live</button>
    <button id="upcomingTab">Upcoming</button>
  </div>

  <!-- Match List Container -->
  <div id="match-list"></div>

  <script>
    // Telegram Join Popup
    const telegramLink = "https://t.me/BDStreamHub_Discussion0";
    function hasJoined() {
      return localStorage.getItem('joinedTelegram') === "true";
    }
    function showJoinPopup() {
      if (hasJoined()) return;
      const popup = document.createElement('div');
      popup.style = `
        position: fixed; top:0; left:0; width:100vw; height:100vh;
        background: rgba(0,0,0,0.85); display:flex;
        justify-content:center; align-items:center; z-index:9999;
      `;
      popup.innerHTML = `
        <div style="background:#222; padding:30px; border-radius:12px; text-align:center; max-width:320px; color:#fff;">
          <h2>‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
          <p>‡¶∏‡¶ï‡¶≤ ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶™‡ßá‡¶§‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
          <a href="${telegramLink}" target="_blank" style="display:inline-block; background:#08f; color:#111; padding:12px 25px; border-radius:30px; font-weight:700; text-decoration:none;">Join Now</a>
          <br><br>
          <button id="popupClose" style="background:#555; color:#ddd; border:none; padding:8px 15px; border-radius:6px; cursor:pointer;">Close</button>
        </div>
      `;
      document.body.appendChild(popup);
      document.getElementById('popupClose').onclick = () => {
        localStorage.setItem('joinedTelegram', 'true');
        document.body.removeChild(popup);
      };
    }
    showJoinPopup();

    // API URL
    const apiUrl = "https://script.google.com/macros/s/AKfycbys6AFNs2s1MKZ1zyJxaeUW-_Vmq5BuIEC8Qjyr-zXkx_x28F7rWTi2D0EmQlnsPvTnCQ/exec";
    let matches = [];

    // Fetch data once
    async function fetchData() {
      try {
        const res = await fetch(apiUrl);
        const data = await res.json();
        matches = data.matches || [];
        document.getElementById('notice-text').textContent = data.Notice || "Welcome to BDStreamHub!";
        renderMatches();
      } catch (e) {
        console.error(e);
        document.getElementById('notice-text').textContent = "Failed to load notice.";
      }
    }

    // Mobile detection
    function isMobile() {
      return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile/i.test(navigator.userAgent);
    }

    // Stream opener
    function openStream(url) {
      if (isMobile()) {
        window.location.href = url;
      } else {
        window.open(url, '_blank');
      }
    }

    // Format ms to D H M S
    function formatTime(ms) {
      let s = Math.floor(ms/1000), m = Math.floor(s/60), h = Math.floor(m/60), d = Math.floor(h/24);
      h %= 24; m %= 60; s %= 60;
      return `${d}d ${h}h ${m}m ${s}s`;
    }

    // Render matches list
    function renderMatches() {
      const list = document.getElementById('match-list');
      list.innerHTML = '';
      const now = new Date();
      const filter = document.getElementById('search').value.toLowerCase();
      const showLive = document.getElementById('liveTab').classList.contains('active');

      matches.forEach(m => {
        const mt = new Date(m.MatchTime);
        const diff = now - mt;
        const isLive = diff >= 0 && diff < 2*60*60*1000; // 2h window

        if (showLive !== isLive) return;
        if (filter && !(
          m.Match.toLowerCase().includes(filter) ||
          m.Team1.toLowerCase().includes(filter) ||
          m.Team2.toLowerCase().includes(filter)
        )) return;

        // Build element
        const div = document.createElement('div');
        div.className = 'match';
        div.innerHTML = `
          <div class="teams">
            <img src="${m.Team1Logo}" alt="${m.Team1}">
            <div class="team-name">${m.Team1}</div>
            <div style="margin: 0 8px; font-size:18px;">vs</div>
            <div class="team-name">${m.Team2}</div>
            <img src="${m.Team2Logo}" alt="${m.Team2}">
          </div>
          <div class="status">
            ${isLive
              ? `<div class="live-badge">LIVE</div>
                 <div class="countdown" data-target="${mt.toISOString()}">${Math.floor(diff/60000)}m ago</div>`
              : `<div class="countdown" data-target="${mt.toISOString()}">${formatTime(mt - now)}</div>`
            }
          </div>
          <div class="datetime">
            ${mt.toLocaleDateString('en-CA')}<br>${mt.toLocaleTimeString('en-US', {hour12:false})}
          </div>
          <div class="servers">
            ${m.Intent1 ? `<a href="javascript:void(0)" onclick="openStream('${m.Intent1}')">Server 1</a>` : ''}
            ${m.Intent2 ? `<a href="javascript:void(0)" onclick="openStream('${m.Intent2}')">Server 2</a>` : ''}
            ${m.Intent3 ? `<a href="javascript:void(0)" onclick="openStream('${m.Intent3}')">Server 3</a>` : ''}
          </div>
        `;
        list.appendChild(div);
      });
    }

    // Single global interval for countdown updates
    setInterval(() => {
      document.querySelectorAll('.countdown').forEach(el => {
        const target = new Date(el.getAttribute('data-target'));
        const now = new Date();
        const diff = now - target;
        if (diff >= 0 && diff < 2*60*60*1000) {
          // Match is now live
          const parent = el.parentElement;
          parent.innerHTML = `<div class="live-badge">LIVE</div>
                              <div class="countdown">${Math.floor(diff/60000)}m ago</div>`;
        } else if (diff >= 2*60*60*1000) {
          // Match ended‚Äîremove or mark ended
          el.textContent = 'Ended';
        } else {
          // Upcoming
          const remaining = target - now;
          el.textContent = formatTime(remaining);
        }
      });
    }, 1000);

    // Search & tab events
    document.getElementById('search').addEventListener('input', renderMatches);
    document.getElementById('liveTab').onclick = () => {
      document.getElementById('liveTab').classList.add('active');
      document.getElementById('upcomingTab').classList.remove('active');
      renderMatches();
    };
    document.getElementById('upcomingTab').onclick = () => {
      document.getElementById('upcomingTab').classList.add('active');
      document.getElementById('liveTab').classList.remove('active');
      renderMatches();
    };

    // Initial data fetch
    fetchData();
  </script>

</body>
</html>
